# 아키텍쳐

## 시작
내가 생각하는 개발이란 기능보다 아키텍쳐가 중요하다고 생각한다.
기능은 ai를 이용하여 만들 수 있지만, 장기적으로 봤을 때 개발은 유지보수를 더 많이 한다.
따라서, 아키텍쳐에 대해서 배워보자.

## 아키텍쳐란 무엇인가?
서비스에 맞는 전체적인 구성과 설계를 하는 것을 말한다.

## 종류
- 레이어드 아키텍쳐
- 클린 아키텍쳐
- 헥사고날 아키텍쳐


## 레이어드 아키텍쳐
- 관심사가 같은 것들을 묶어서 설계하는 방식
- Client -> Presentation -> Application -> Persistence 
- 크게 Presentation , domain, dataSource로 구성되어진다.
  표현 계층(Presentation Layer) 은 사용자 입력을 처리하기 위해 존재합니다.
  도메인 계층(Domain Layer) 은 비즈니스와 관련된 로직을 수행하기 위해 존재합니다.
  데이터 소스 계층(Data Source Layer) 은 데이터베이스 접근 및 데이터 조작과 관련된 작업을 수행하기 위해 존재합니다.

tip
- persistence layer
  - = data access layer 
  - 데이터 crud와 관련된 모든 로직을 처리하는 코드상의 영역을 나타냅니다.


### 레이어드 특징
- 계층화로 인한 분리된 책임
- 편의에 따라 여러 계층을 추가 가능하다.
- Presentation, application, domain, persistence
- 구조가 쉽고 단순하고 익숙하다
- 데이터베이스 주도 설계가 될 수 있다.
- 상위 레이어가 하위 레이어를 가지고 있다.
  - 하위 레이어의 변경이 상위 레이어에 영향을 줍니다.
  - 이것이 바로 의존성이 생겼다고 할 수 있습니다.
  - 따라서, 코드 변경이 어렵다.
  
![img_3.png](img_3.png)
![img_5.png](img_5.png)
### 레이어드 아키텍쳐의 문제점
- 의존성 떄문에 하위 계층의 변경이 프로젝트 전체에 영향을 줍니다.
- 해결법
   - 프로젝트 전체가 db에 의존하는 대신, 도메인에 의존하게 바꿉니다.
   - 의존성 방향이 안쪽으로만 흐른다 = 클린 아키텍쳐 

## 클린 아키텍쳐
![img_4.png](img_4.png)
- 의존성 역전을 통해 도메인이 중심이 되는 설계 방법

### 클린 아키텍쳐 구조
- 크게 두가지 계층으로로 나누는데, 엔티티와 유즈 케이스인 내부와 외부로 분리하는 게 핵심입니다.
- 총 4가지로 구성되어 있다.
  - 엔티티 레이어 (enterprise)
    - 핵심적인 엔티티나 도메인 객체를 의미
    - 비지니스 로직이나 규칙을 나타내며 외부 요소에 대한 어떠한 의존성도 x
  - 유스케이스 레이어 (application)
    - 비지니스 로직을 포함하고, 레파지토리에서 데이터를 받아옵니다
  - 인터페이스 어댑터 (interface adapters)
    - 데이터를 어플리케이션에서 사용하는 형태로 변환하거나, 내부에서 사용하는 데이터를 외부에 적합한 형태로 변환
    - controllers
  - 인프라스트럭쳐 레이어
    - 외부 요소, 특정 프레임워크나 기술에 의존하는 부분을 의미한다.
  
### 클린 아키텍쳐 특징
- 핵심 규칙을 담고 있는 도메인이 중심
- 도메인이 세부 사항(db, 입출력 장치, 웹 시스템, 프레임워크)에 의존하지 않는다.


## 헥사고날 아키텍쳐
![img_7.png](img_7.png)
클린 아키텍쳐를 적용하는 아키텍쳐로, 외부 요소와 핵심 비지니스 로직이 통신할 때
port를 통해서 통신해야 한다는 것입니다.


### 헥사고날 아키텍쳐 특징
- 큰 비지니스 가치를 가지고 있는 도메인 모델에 큰 관심
- 포트와 어뎁터를 구성하고 관리하는 데 복잡성이 따른다.
- 도메인에 라이브러리를 직접 활용하기 어렵다.

### 구조
- 도메인 모델 : 애플리케이션의 핵심 기능, 비지니스 로직을 규칙을 캡슐화합니다.
- 포트 : 애플리케이션의 도메인 모델과 외부의 통신 인터페이스를 정의
  - 입력 포트 : 유스케이스를 호출하는 포트, 동작을 유발하는 외부 요청을 처리합니다.
  - 출력 포트 : 유스케이스로 부터 호출되서 동작의 결과를 외부로 전달합니다.
- 어뎁터 : 외부 요소를 직접 다루는 곳입니다.
  - 외부와의 구현을 한다.

### 이해해보기
- controller는 포트만 접근 할 수 있다.
- reposiotry에 있는 port로 부터 유스케이스의 결과를 저장한다.

### 헥사고날 아키텍쳐로 바꿔보기
1. 서비스와 레포지토리의 메서드를 인터페이스로 분리한다.
   - Service ->  useCase, service , repository
   - 서비스의 메서드를 유스케이스로 만든다.
   -  레파지토리를 인터페이스로 만든다.
2. 도메인 분리한다.
- jpa의 member를 service에서 의존하지 않고, domain을 서비스에 의존시킨다.
  -> 패키지간 양방향 의존 관계를 끊어 낼 수 있다.
![img_6.png](img_6.png)